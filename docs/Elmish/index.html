<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bolero: F# in WebAssembly</title>
  <link rel="icon" type="image/png" href="img/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32" />
  <link rel="stylesheet" href="/css/all.min.css" />
  <meta id='websharper-data' name='websharper-data' content='{"$TYPES":[["WebSharper","UI","Templating","Runtime","Server","TemplateInitializer"]],"$DATA":{"$V":{"13e44be7-7df9-4740-9c6f-2b9d91055dca":{"$T":0,"$V":{"vars":[["drawershown",0]]}},"af82c9c1-acc1-4844-a701-b2d5c282f7c3":{"$T":0,"$V":{"vars":[]}},"7e6bacd9-8877-4822-8c22-3803884353f2":{"$T":0,"$V":{"vars":[]}},"ff076f62-108e-490d-9b3d-2e06c122de91":{"$T":0,"$V":{"vars":[]}},"a0062520-0351-436a-8bf6-d121f84c48e2":{"$T":0,"$V":{"vars":[]}},"370ced9a-dee8-4666-9653-d85ea5a26f08":{"$T":0,"$V":{"vars":[]}},"b7c01e37-3b1e-43c6-855f-8cf51afbc693":{"$T":0,"$V":{"vars":[]}},"cb62335c-f017-447a-8dd4-aa00f25a79c8":{"$T":0,"$V":{"vars":[]}},"dc920ba0-5cd2-468c-9266-41f0827bb79b":{"$T":0,"$V":{"vars":[]}},"1b30b2de-0ade-44c5-a0c7-2ed21ce4b832":{"$T":0,"$V":{"vars":[]}}}}}' />

</head>
<body>
  <header class="navbar overlay-bar">
    <div class="navbar-brand">
      <a class="navbar-item is-hoverable" onclick="WebSharper.UI.Templating.Runtime.Server.Handler.EventQ2$184$36(&quot;13e44be7-7df9-4740-9c6f-2b9d91055dca&quot;,Website.Main.Site.Page$29$24())(this)(event)"><i class="fa fa-bars"></i></a>
      <span class="navbar-item"><a href="/">Bolero</a></span>
    </div>
    <div class="navbar-menu">
      <nav class="navbar-end"><a href="/" class="navbar-item is-hoverable has-text-weight-bold">Home</a><a href="/docs" class="navbar-item is-hoverable has-text-weight-bold">Documentation</a><a href="/blog" class="navbar-item is-hoverable has-text-weight-bold">Blog</a><a href="https://try.fsbolero.io" class="navbar-item is-hoverable has-text-weight-bold">Try F#</a></nav>
    </div>
  </header>
  <div class="drawer-backdrop ${13e44be7-7df9-4740-9c6f-2b9d91055dca::drawershown}" onclick="WebSharper.UI.Templating.Runtime.Server.Handler.EventQ2$184$36(&quot;13e44be7-7df9-4740-9c6f-2b9d91055dca&quot;,Website.Main.Site.Page$30$24())(this)(event)">
    <input type="hidden" ws-var="13e44be7-7df9-4740-9c6f-2b9d91055dca::drawershown" />
    <div id="left-drawer" class="lhs-drawer ${13e44be7-7df9-4740-9c6f-2b9d91055dca::drawershown}">
      <span class="navbar-item"><a href="/">Bolero</a></span>
      <nav><a href="/" class="navbar-item nav-menu-link">Home</a><a href="/docs" class="navbar-item nav-menu-link">Documentation</a><a href="/blog" class="navbar-item nav-menu-link">Blog</a><a href="https://try.fsbolero.io" class="navbar-item nav-menu-link">Try F#</a></nav>
    </div>
  </div>
  
      <section class="hero is-dark page-banner">
        <div class="hero-body has-text-centered">
          <h1 class="title is-spaced">Bolero</h1>
        </div>
      </section>
      <section class="section">
        <div class="container content"><p>Bolero applications use the Model-View-Update architecture using the <a href="https://elmish.github.io/elmish/">Elmish</a> library.</p>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<ul>
<li><a href="#program-component">Program component</a></li>
<li><a href="#view-components">View components</a>
<ul>
<li><a href="#customizing-the-model-update-check">Customizing the model update check</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="program-component">Program component</h1>
<p>The main component for a Bolero application is <code>ProgramComponent&lt;'model, 'msg&gt;</code>. This is a Blazor component whose content is defined by an Elmish program.</p>
<p>For example, given the following simple Elmish counter program:</p>
<pre><code class="language-fsharp">type Model = { value: int }
let initModel = { value = 0 }

type Message = Increment | Decrement
let update message model =
    match message with
    | Increment -&gt; { model with value = model.value + 1 }
    | Decrement -&gt; { model with value = model.value - 1 }

let view model dispatch =
    div [] [
        button [on.click (fun _ -&gt; dispatch Decrement)] [text &quot;-&quot;]
        text (string model.value)
        button [on.click (fun _ -&gt; dispatch Increment)] [text &quot;+&quot;]
    ]

let program =
    Program.mkSimple (fun _ -&gt; initModel) update view
</code></pre>
<p>You can wrap it in a Blazor component as follows:</p>
<pre><code class="language-fsharp">open Elmish
open Bolero

type MyApp() =
    inherit ProgramComponent&lt;Model, Message&gt;()

    override this.Program = program
</code></pre>
<h1 id="view-components">View components</h1>
<p>Bolero works by calling the <code>view</code> on every <code>update</code>, and then diffing the returned node against the previously rendered page. This means that a part of the page that doesn't change after a given update still takes some computation to realize that it hasn't changed.</p>
<p>Take the following example:</p>
<pre><code class="language-fsharp">type Model = { firstName: string; lastName: string }
let initModel = { firstName = &quot;&quot;; lastName = &quot;&quot; }

type Message = SetFirstName of string | SetLastName of string
let update message model =
    match message with
    | SetFirstName n -&gt; { model with firstName = n }
    | SetLastName n -&gt; { model with lastName = n }

let viewInput model setValue =
    input [
        attr.value model
        on.change (fun e -&gt; setValue (unbox e.Value))
    ]

let view model dispatch =
    div [] [
        viewInput model.firstName (fun n -&gt; dispatch (SetFirstName n))
        viewInput model.lastName (fun n -&gt; dispatch (SetLastName n))
        text (sprintf &quot;Hello, %s %s!&quot; model.firstName model.lastName)
    ]
</code></pre>
<p>This displays two input boxes prompting the user for a first name and a last name. On every change, <code>view</code> is called, and therefore <code>viewInput</code> is called twice, even though only one field has changed. Of course this is a tiny application so this doesn't cause any noticeable performance issue, but as the app gets bigger, this kind of unnecessary work may become a problem.</p>
<p>This can be improved using <code>ElmishComponent&lt;'model, 'msg&gt;</code>. This component type only calls its view if its model has changed. It is typically used by passing a sub-model, rather than the full model; for example, in our case, we'll just pass the relevant field: either <code>model.firstName</code> or <code>model.lastName</code>.</p>
<pre><code class="language-fsharp">type Input() =
    // The first `string` is the model type.
    // The second `string` is the message type.
    inherit ElmishComponent&lt;string, string&gt;()

    override this.View model dispatch =
        input [
            attr.value model
            on.change (fun e -&gt; dispatch (unbox e.Value))
        ]
</code></pre>
<p>Instantiating an <code>ElmishComponent</code> is done using the function <code>ecomp</code>. This function is parameterized by the component type, and takes a model and a dispatch function as arguments.</p>
<pre><code class="language-fsharp">let view model dispatch =
    div [] [
        ecomp&lt;Input,_,_&gt; model.firstName (fun n -&gt; dispatch (SetFirstName n))
        ecomp&lt;Input,_,_&gt; model.lastName (fun n -&gt; dispatch (SetLastName n))
        text (sprintf &quot;Hello, %s %s!&quot; model.firstName model.lastName)
    ]
</code></pre>
<h2 id="customizing-the-model-update-check">Customizing the model update check</h2>
<p>Let's improve our <code>Input</code> component by adding a label. We can change the model to a record that contains both the label and the value.</p>
<pre><code class="language-fsharp">type InputModel = { label: string; value: string }

type Input() =
    inherit ElmishComponent&lt;InputModel, string&gt;()
</code></pre>
<p>Since we know that the label of a given component will always be the same, we'd like <code>Input</code> to only look at the value when checking whether the model has changed. By default, <code>ElmishComponent</code> checks whether the model has changed by calling <code>obj.ReferenceEquals</code> on the old and new models. To specify a different check, we can override <code>ShouldRender(oldModel, newModel)</code>.</p>
<pre><code class="language-fsharp">type InputModel = { label: string; value: string }

type Input() =
    inherit ElmishComponent&lt;InputModel, string&gt;()

    // Check for model changes by only looking at the value.
    override this.ShouldRender(oldModel, newModel) =
        oldModel.value &lt;&gt; newModel.value

    override this.View model dispatch =
        label [] [
            text model.label
            input [
                attr.value model.value
                on.change (fun e -&gt; dispatch (unbox e.Value))
            ]
        ]

let view model dispatch =
    div [] [
        ecomp&lt;Input,_,_&gt; {
            label = &quot;First name: &quot;
            value = model.firstName
         } (fun n -&gt; dispatch (SetFirstName n))
        ecomp&lt;Input,_,_&gt; {
            label = &quot;Last name: &quot;
            value = model.lastName
         } (fun n -&gt; dispatch (SetLastName n))
        text (sprintf &quot;Hello, %s %s!&quot; model.firstName model.lastName)
    ]
</code></pre>
</div>
      </section>
    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-lazyload/8.6.0/lazyload.min.js"></script>
  <script type="text/javascript">new LazyLoad();</script>
  <script src="../../Scripts/WebSharper.Core.JavaScript/Runtime.min.js" type="text/javascript" charset="UTF-8"></script><!--[if lte IE 7.0]>
<script src="../../Scripts/WebSharper.Main/Json.min.js" type="text/javascript" charset="UTF-8"></script><![endif]-->
<!--[if lte IE 9.0]>
<script src="../../Scripts/WebSharper.Main/AnimFrame.min.js" type="text/javascript" charset="UTF-8"></script><![endif]-->
<script src="../../Scripts/WebSharper.Main/WebSharper.Main.min.js" type="text/javascript" charset="UTF-8"></script><script src="../../Scripts/WebSharper.Collections/WebSharper.Collections.min.js" type="text/javascript" charset="UTF-8"></script><script src="../../Scripts/WebSharper.UI/WebSharper.UI.min.js" type="text/javascript" charset="UTF-8"></script><script src="../../Scripts/WebSharper.UI.Templating.Runtime/WebSharper.UI.Templating.Runtime.min.js" type="text/javascript" charset="UTF-8"></script><script src="../../Scripts/Website/Website.min.js" type="text/javascript" charset="UTF-8"></script><script type="text/javascript">
if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '../../Scripts/';
  IntelliFactory.Runtime.Start();
}
</script>

  
  
</body>
</html>